From bf9022b128589d788b5c6a1ca20f05c82c57a7da Mon Sep 17 00:00:00 2001
From: Rajab Natshah <33889-RajabNatshah@users.noreply.drupalcode.org>
Date: Mon, 14 Jul 2025 17:32:08 +0000
Subject: [PATCH 1/2] Issue #3535874: Add Navigation Top Bar integration for
 Coffee module in Drupal ~11.2.0 and Gin ~5.0

---
 src/Plugin/TopBarItem/CoffeeTopBarItem.php | 116 +++++++++++++++++++++
 1 file changed, 116 insertions(+)
 create mode 100644 src/Plugin/TopBarItem/CoffeeTopBarItem.php

diff --git a/src/Plugin/TopBarItem/CoffeeTopBarItem.php b/src/Plugin/TopBarItem/CoffeeTopBarItem.php
new file mode 100644
index 0000000..5f8822e
--- /dev/null
+++ b/src/Plugin/TopBarItem/CoffeeTopBarItem.php
@@ -0,0 +1,116 @@
+<?php
+
+declare(strict_types=1);
+
+namespace Drupal\coffee\Plugin\TopBarItem;
+
+use Drupal\Core\Plugin\ContainerFactoryPluginInterface;
+use Drupal\Core\Session\AccountProxyInterface;
+use Drupal\Core\StringTranslation\StringTranslationTrait;
+use Drupal\Core\StringTranslation\TranslatableMarkup;
+use Drupal\navigation\Attribute\TopBarItem;
+use Drupal\navigation\TopBarItemBase;
+use Drupal\navigation\TopBarRegion;
+use Symfony\Component\DependencyInjection\ContainerInterface;
+use Drupal\Core\Url;
+
+/**
+ * Provides the Coffee top bar item.
+ */
+#[TopBarItem(
+  id: 'coffee_topbar',
+  region: TopBarRegion::Tools,
+  label: new TranslatableMarkup('Coffee'),
+)]
+class CoffeeTopBarItem extends TopBarItemBase implements ContainerFactoryPluginInterface {
+
+  use StringTranslationTrait;
+
+  /**
+   * Constructs a new CoffeeTopBarItem instance.
+   *
+   * @param array $configuration
+   *   A configuration array containing plugin instance information.
+   * @param string $plugin_id
+   *   The plugin ID for the plugin instance.
+   * @param mixed $plugin_definition
+   *   The plugin implementation definition.
+   * @param \Drupal\Core\Session\AccountProxyInterface $currentUser
+   *   The current user.
+   */
+  public function __construct(
+    array $configuration,
+    string $plugin_id,
+    $plugin_definition,
+    protected AccountProxyInterface $currentUser,
+  ) {
+    parent::__construct($configuration, $plugin_id, $plugin_definition);
+  }
+
+  /**
+   * {@inheritdoc}
+   */
+  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {
+    return new static(
+      $configuration,
+      $plugin_id,
+      $plugin_definition,
+      $container->get('current_user'),
+    );
+  }
+
+  /**
+   * {@inheritdoc}
+   */
+  public function build(): array {
+    $build = [
+      '#cache' => [
+        'contexts' => [
+          'user.permissions',
+          'route',
+        ],
+      ],
+    ];
+    // Check if the user has the required permission.
+    if (!$this->currentUser->hasPermission('access coffee')) {
+      return $build;
+    }
+
+    return $this->buildCoffeeNavigation();
+
+    return $build;
+  }
+
+  /**
+   * Builds the Coffee navigation render array.
+   *
+   * @param array $cache_contexts
+   *   The cache contexts.
+   *
+   * @return array
+   *   A render array for the Coffee navigation.
+   */
+  protected function buildCoffeeNavigation(): array {
+
+    return [
+      '#theme' => 'button',
+      '#cache' => [
+        'contexts' => ['user.permissions'],
+      ],
+      '#attached' => [
+        'library' => ['coffee/drupal.coffee'],
+      ],
+      '#type' => 'tab',
+      'tab' => [
+        '#type' => 'link',
+        '#title' => t('Go to'),
+        '#url' => Url::fromRoute('<none>'),
+        '#attributes' => [
+          'title' => t('Use alt+d to start Coffee and search for a page to go to'),
+          'class' => ['toolbar-icon-coffee', 'toolbar-button', 'toolbar-button--icon--help'],
+        ],
+      ],
+    ];
+  }
+
+}
-- 
GitLab


From 8c6aded3614f0e20f207dfa89471c5bb9ce51151 Mon Sep 17 00:00:00 2001
From: Rajab Natshah <33889-RajabNatshah@users.noreply.drupalcode.org>
Date: Thu, 17 Jul 2025 14:54:34 +0000
Subject: [PATCH 2/2] Switched to use navigation:toolbar-button and added an
 icon for coffee and moved to the Navigation Top Bar Action regtion

---
 coffee.icons.yml                           | 36 ++++++++++++++++++++++
 images/icons/coffee.svg                    |  6 ++++
 src/Plugin/TopBarItem/CoffeeTopBarItem.php | 31 +++++++++++--------
 3 files changed, 61 insertions(+), 12 deletions(-)
 create mode 100644 coffee.icons.yml
 create mode 100644 images/icons/coffee.svg

diff --git a/coffee.icons.yml b/coffee.icons.yml
new file mode 100644
index 0000000..e003d97
--- /dev/null
+++ b/coffee.icons.yml
@@ -0,0 +1,36 @@
+coffee:
+  enabled: true
+  label: "Coffe"
+  description: "Icons available within Coffee module."
+  version: 11.x
+  license:
+    name: GPL2-or-later
+    url: https://api.drupal.org/api/drupal/core%21LICENSE.txt/11.x
+    gpl-compatible: true
+  extractor: svg
+  config:
+    sources:
+      - images/icons/*.svg
+  settings:
+    size:
+      title: "Size"
+      description: "Set a size for this icon."
+      type: "integer"
+      default: 20
+    class:
+      title: "Class"
+      description: "Set a class for this icon."
+      type: "string"
+      default: ""
+  template: >
+    <svg
+      {{ attributes
+          .setAttribute('viewBox', attributes.viewBox|default('0 0 24 24'))
+          .setAttribute('class', class)
+          .setAttribute('width', size|default('20'))
+          .setAttribute('height', size|default('20'))
+          .setAttribute('aria-hidden', 'true')
+      }}
+    >
+      {{ content }}
+    </svg>
diff --git a/images/icons/coffee.svg b/images/icons/coffee.svg
new file mode 100644
index 0000000..e6f1287
--- /dev/null
+++ b/images/icons/coffee.svg
@@ -0,0 +1,6 @@
+<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
+  <g fill="none" stroke="currentColor" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round">
+    <circle cx="11" cy="11" r="8" />
+    <path d="m21 21-4.35-4.35" />
+  </g>
+</svg>
\ No newline at end of file
diff --git a/src/Plugin/TopBarItem/CoffeeTopBarItem.php b/src/Plugin/TopBarItem/CoffeeTopBarItem.php
index 5f8822e..bd6edd5 100644
--- a/src/Plugin/TopBarItem/CoffeeTopBarItem.php
+++ b/src/Plugin/TopBarItem/CoffeeTopBarItem.php
@@ -12,6 +12,7 @@ use Drupal\navigation\Attribute\TopBarItem;
 use Drupal\navigation\TopBarItemBase;
 use Drupal\navigation\TopBarRegion;
 use Symfony\Component\DependencyInjection\ContainerInterface;
+use Drupal\Core\Template\Attribute;
 use Drupal\Core\Url;
 
 /**
@@ -19,7 +20,7 @@ use Drupal\Core\Url;
  */
 #[TopBarItem(
   id: 'coffee_topbar',
-  region: TopBarRegion::Tools,
+  region: TopBarRegion::Actions,
   label: new TranslatableMarkup('Coffee'),
 )]
 class CoffeeTopBarItem extends TopBarItemBase implements ContainerFactoryPluginInterface {
@@ -93,23 +94,29 @@ class CoffeeTopBarItem extends TopBarItemBase implements ContainerFactoryPluginI
   protected function buildCoffeeNavigation(): array {
 
     return [
-      '#theme' => 'button',
+      '#type' => 'component',
+      '#component' => 'navigation:toolbar-button',
+      '#props' => [
+        'text' => t('Go To') ,
+        'modifiers' => ['small-offset'],
+        'icon' => ['pack_id' => 'coffee', 'icon_id' => 'coffee'],
+        'html_tag' => 'button',
+        'content' => t('Go To'),
+        'attributes' => new Attribute([
+          'href' => '',
+          'title' => t('Use alt+d to start Coffee and search for a page to go to')
+        ]),
+        'extra_classes' => [
+          'toolbar-icon-coffee',
+        ]
+      ],
       '#cache' => [
         'contexts' => ['user.permissions'],
       ],
       '#attached' => [
         'library' => ['coffee/drupal.coffee'],
       ],
-      '#type' => 'tab',
-      'tab' => [
-        '#type' => 'link',
-        '#title' => t('Go to'),
-        '#url' => Url::fromRoute('<none>'),
-        '#attributes' => [
-          'title' => t('Use alt+d to start Coffee and search for a page to go to'),
-          'class' => ['toolbar-icon-coffee', 'toolbar-button', 'toolbar-button--icon--help'],
-        ],
-      ],
+      '#weight' => -1900,
     ];
   }
 
-- 
GitLab

